<div class="agent-profile-container">
    @if (isLoading) {
    <div style="text-align: center; padding: 50px;">
        <p>{{ 'AGENT_PROFILE.LOADING' | translate }}</p>
    </div>
    } @else {
    @if (agent) {
    <!-- Banner Section -->
    <div class="banner">
        <div class="banner-content">
            <span class="trubroker-text">TruBroker™</span>
        </div>
    </div>

    <!-- Agent Details Section -->
    <div class="agent-header">
        <div class="profile-pic-container">
            <img [src]="agent.profileImageUrl || 'https://placehold.co/400x400?text=No+Image'" [alt]="agent.fullName"
                class="profile-pic">
        </div>

        <div class="agent-info">
            <div class="name-agency">
                <h1 class="agent-name">{{ agent.fullName }}</h1>
                <p class="agency-status">{{ 'AGENT_PROFILE.ACTIVE_AGENT' | translate }}</p>
            </div>

            <div class="badges-actions">
                <!-- Badges -->
                <div class="badges-row">
                    <div class="badge trubroker-badge">
                        <span class="badge-icon">™</span>
                        <span class="badge-text">TruBroker™</span>
                    </div>
                    <div class="badge quality-badge">
                        <i class="fas fa-gem"></i>
                        <span class="badge-text">{{ 'FIND_AGENT.BADGE_QUALITY_TITLE' | translate }}</span>
                    </div>
                    <div class="badge responsive-badge">
                        <i class="fas fa-bolt"></i>
                        <span class="badge-text">{{ 'FIND_AGENT.BADGE_RESPONSIVE_TITLE' | translate }}</span>
                    </div>
                </div>

                <!-- Actions -->
                <div class="actions-row">
                    <button class="action-btn email" (click)="agent && agent.email ? openEmail(agent.email) : null">
                        <i class="far fa-envelope"></i>
                        <span>{{ 'AGENT_PROFILE.EMAIL' | translate }}</span>
                    </button>
                    <button class="action-btn call" (click)="agent && agent.phone ? openCall(agent.phone) : null">
                        <i class="fas fa-phone-alt"></i>
                        <span>{{ 'AGENT_PROFILE.CALL' | translate }}</span>
                    </button>
                    <button class="action-btn whatsapp"
                        (click)="agent && agent.whatsAppNumber ? openWhatsApp(agent.whatsAppNumber) : null">
                        <i class="fab fa-whatsapp"></i>
                        <span>{{ 'AGENT_PROFILE.WHATSAPP' | translate }}</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Body Wrapper -->
    <div class="profile-body">
        <!-- Left Content: Active Properties -->
        <div class="active-properties-section">
            <div class="section-header">
                <h2 class="section-title">{{ 'AGENT_PROFILE.ACTIVE_PROPERTIES_TITLE' | translate }}</h2>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <div class="filter-group location" style="flex: 1;">
                        <input type="text" placeholder="{{ 'AGENT_PROFILE.SEARCH_PLACEHOLDER' | translate }}"
                            class="filter-input" [(ngModel)]="locationSearch" (input)="filterProperties()">
                        <i class="fas fa-map-marker-alt location-icon"></i>
                    </div>
                </div>

                <!-- Sorting Info -->
                <div class="sorting-row">
                    <p class="results-count">{{ 'AGENT_PROFILE.SHOWING_RESULTS' | translate:{count:
                        filteredProperties.length} }}</p>
                    <select class="sort-select">
                        <option>{{ 'AGENT_PROFILE.POPULAR' | translate }}</option>
                    </select>
                </div>
            </div>

            <!-- Properties List -->
            <div class="properties-list">
                @for (prop of filteredProperties; track prop.id) {
                <div class="property-card" [routerLink]="['/propertyview', prop.id]" style="cursor: pointer;">
                    <div class="property-image-container">
                        <img [src]="prop.mainImageUrl || 'https://placehold.co/600x400?text=No+Image'" [alt]="prop.title"
                            class="property-image">
                        @if (prop.isFeatured) {
                        <span class="hot-badge">{{ 'AGENT_PROFILE.HOT' | translate }}</span>
                        }
                        <button class="fav-btn"><i class="far fa-heart"></i></button>
                    </div>
                    <div class="property-details">
                        <h3 class="property-price">EGP {{ prop.price | number }} <span class="period"></span>
                        </h3>
                        <p class="property-specs">
                            <span class="type">{{ prop.propertyType }}</span>
                            <span class="specs"><i class="fas fa-bed"></i> {{ prop.rooms }}</span>
                            <span class="specs"><i class="fas fa-bath"></i> {{ prop.bathrooms }}</span>
                            <span class="area">{{ 'AGENT_PROFILE.AREA' | translate:{value: prop.area} }}</span>
                        </p>
                        <h4 class="property-title">{{ prop.title }}</h4>
                        <p class="property-location"><i class="fas fa-map-marker-alt"></i> {{ prop.location ||
                            prop.cityName }}</p>

                        <div class="property-actions">
                            <button class="prop-action-btn email"><i class="far fa-envelope"></i> {{
                                'AGENT_PROFILE.EMAIL' | translate }}</button>
                            <button class="prop-action-btn call"><i class="fas fa-phone-alt"></i> {{
                                'AGENT_PROFILE.CALL' | translate }}</button>
                            <button class="prop-action-btn whatsapp"><i class="fab fa-whatsapp"></i></button>
                        </div>
                    </div>
                </div>
                } @empty {
                <p>{{ 'AGENT_PROFILE.NO_PROPERTIES' | translate }}</p>
                }
            </div>
        </div>

        <!-- Right Content: About Sidebar -->
        <aside class="about-sidebar">
            <h2 class="sidebar-title">{{ 'AGENT_PROFILE.ABOUT_TITLE' | translate }}</h2>

            <div class="about-info-item">
                <h3 class="label">{{ 'AGENT_PROFILE.LANGUAGE_LABEL' | translate }}</h3>
                <!-- Hardcoded for now as it's not in the new model, or assumed default -->
                <p class="value">{{ 'AGENT_PROFILE.LANGUAGES_VALUE' | translate }}</p>
            </div>

            <div class="about-info-item">
                <h3 class="label">{{ 'AGENT_PROFILE.EXPERTISE_LABEL' | translate }}</h3>
                <!-- Hardcoded or derived -->
                <p class="value">{{ 'AGENT_PROFILE.EXPERTISE_VALUE' | translate }}</p>
            </div>

            <div class="about-info-item">
                <h3 class="label">{{ 'AGENT_PROFILE.SERVICE_AREAS_LABEL' | translate }}</h3>
                <p class="value underline-links">
                    <span>{{ 'AGENT_PROFILE.ACTIVE_PROPERTIES_COUNT' | translate }} ({{ agent.activePropertiesCount
                        }}),</span>
                    <span>{{ 'AGENT_PROFILE.TOTAL_PROPERTIES_COUNT' | translate }} ({{ agent.totalPropertiesCount
                        }})</span>
                </p>
            </div>

            <div class="about-info-item">
                <h3 class="label">{{ 'AGENT_PROFILE.SINCE_LABEL' | translate }}</h3>
                <p class="value rtl-desc">{{ agent.createdAt | date:'mediumDate' }}</p>
            </div>

            <div class="about-info-item">
                <h3 class="label">{{ 'AGENT_PROFILE.VERIFICATION_LABEL' | translate }}</h3>
                <p class="value">{{ (agent.isVerified ? 'AGENT_PROFILE.VERIFIED' : 'AGENT_PROFILE.NOT_VERIFIED') |
                    translate }}</p>
            </div>
        </aside>
    </div>
    } @else {
    <div style="text-align: center; padding: 50px;">
        <p>{{ 'AGENT_PROFILE.NOT_FOUND' | translate }}</p>
    </div>
    }
    }
</div>