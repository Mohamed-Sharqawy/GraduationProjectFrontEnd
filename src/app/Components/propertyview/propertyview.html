<div class="property-container" *ngIf="!isLoading && !errorMessage">
    <!-- Image Gallery -->
    <div class="gallery-section" *ngIf="property && property.images && property.images.length > 0">
        <div class="gallery-grid">
            <div class="main-image">
                <img [src]="mainImageUrl" [alt]="title">
            </div>
            <div class="side-images">
                <img *ngFor="let img of property.images.slice(1, 3); let i = index" 
                     [src]="img.imageUrl" 
                     [alt]="title + ' - ' + (i + 2)">
            </div>
        </div>
    </div>

    <div class="content-layout">
        <main class="property-details">
            <!-- Header Section -->
            <div class="header-section">
                <!-- Price -->
                <div class="price-row">
                    <h1>{{ price | currency: currency :'symbol':'1.0-0' }}</h1>
                    <span class="installment-tag" *ngIf="rentPriceMonthly > 0">
                        {{ rentPriceMonthly | currency: currency :'symbol':'1.0-0' }} {{ 'PROPERTY_VIEW.MONTHLY_RENT' | translate }}
                    </span>
                    <span class="installment-tag" *ngIf="rentPriceMonthly === 0">
                        {{ currency }} {{ installment }} / {{ installmentPeriod }}
                    </span>
                </div>

                <!-- Down Payment -->
                <div class="down-payment-row" *ngIf="rentPriceMonthly === 0">
                    <span class="down-payment-badge">
                        üíµ {{ 'PROPERTY_VIEW.DOWN_PAYMENT' | translate }}: {{ currency }} {{ downPayment }}
                    </span>
                </div>

                <!-- Location -->
                <h2 class="location-title">{{ location }}</h2>

                <!-- Specs -->
                <div class="specs-horizontal">
                    <span class="spec-item" *ngIf="specs.beds > 0">
                        üõè {{ specs.beds }} {{ specs.beds > 1 ? ('PROPERTY_VIEW.BEDS' | translate) : ('PROPERTY_VIEW.BED' | translate) }}
                    </span>
                    <span class="spec-item" *ngIf="specs.baths > 0">
                        üõÅ {{ specs.baths }} {{ specs.baths > 1 ? ('PROPERTY_VIEW.BATHS' | translate) : ('PROPERTY_VIEW.BATH' | translate) }}
                    </span>
                    <span class="spec-item" *ngIf="specs.area > 0">
                        üìê {{ specs.area }} {{ 'PROPERTY_VIEW.SQ_M' | translate }}
                    </span>
                </div>

                <!-- Title & Description -->
                <div class="description-section">
                    <h3>{{ title }}</h3>
                    <ul class="desc-list" *ngIf="description.length > 0">
                        <li *ngFor="let line of description">{{ line }}</li>
                    </ul>
                </div>

                <!-- Property Info Table -->
                <section class="info-table">
                    <h3>{{ 'PROPERTY_VIEW.PROPERTY_INFO_TITLE' | translate }}</h3>
                    <div class="grid-info">
                        <div class="info-item" *ngFor="let item of propertySpecs">
                            <span class="label">{{ item.label }}</span>
                            <span class="value">{{ item.value }}</span>
                        </div>
                    </div>
                </section>

                <!-- Amenities -->
                <section class="amenities-section" *ngIf="property && property.amenities && property.amenities.length > 0">
                    <h3>{{ 'PROPERTY_VIEW.AMENITIES_TITLE' | translate }}</h3>
                    <div class="amenities-grid">
                        <div class="amenity-item" *ngFor="let amenity of property.amenities">
                            <i class="fa fa-check-circle" style="color: #28b16d;"></i>
                            {{ currentLang === 'en' ? (amenity.nameEn || amenity.name) : amenity.name }}
                        </div>
                    </div>
                </section>
            </div>
        </main>

        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Agent Card -->
            <div class="broker-card">
                <div class="broker-header">
                    <img [src]="agent.imageUrl || 'https://via.placeholder.com/80'" 
                         [alt]="agent.name" 
                         class="profile-pic">
                    <div class="broker-info">
                        <h3 class="agent-name" 
                            (click)="viewAgentProfile()" 
                            style="cursor: pointer; color: #28b16d; margin: 0;">
                            {{ agent.name }}
                        </h3>
                        <p class="agent-stats">{{ agent.activeListings }} {{ 'PROPERTY_VIEW.ACTIVE_LISTINGS' | translate }}</p>
                    </div>
                </div>

                <div class="actions">
                    <button class="btn-call" (click)="callAgent()" *ngIf="agent.phone">
                        üìû {{ 'PROPERTY_VIEW.CALL' | translate }}
                    </button>
                    <button class="btn-email" (click)="emailAgent()" *ngIf="agent.email">
                        ‚úâ {{ 'PROPERTY_VIEW.EMAIL' | translate }}
                    </button>
                    <button class="btn-whatsapp" (click)="whatsappAgent()" *ngIf="agent.whatsapp">
                        üí¨ {{ 'PROPERTY_VIEW.WHATSAPP' | translate }}
                    </button>
                </div>
            </div>

            <!-- Save Property Button -->
            <div class="save-property-card">
                <button (click)="toggleSave()" class="save-btn" [class.saved]="isSaved">
                    <i class="fa" [class.fa-heart]="isSaved" [class.fa-heart-o]="!isSaved"></i>
                    {{ isSaved ? ('PROPERTY_VIEW.UNSAVE_PROPERTY' | translate) : ('PROPERTY_VIEW.SAVE_PROPERTY' | translate) }}
                </button>
            </div>
        </aside>
    </div>

    <!-- Similar Properties Section -->
    <section class="similar-properties-section" *ngIf="similarProperties.length > 0">
        <h2>{{ 'PROPERTY_VIEW.SIMILAR_PROPERTIES' | translate }}</h2>
        <div class="properties-grid">
            <div class="property-card" *ngFor="let prop of similarProperties" [routerLink]="['/propertyview', prop.id]">
                <div class="card-image">
                    <img [src]="prop.mainImageUrl || 'https://via.placeholder.com/300x200'" 
                         [alt]="getSimilarPropertyTitle(prop)">
                    <span class="badge" *ngIf="prop.isFeatured">‚≠ê {{ 'LISTING_PROPERTIES.FEATURED' | translate }}</span>
                </div>
                <div class="card-content">
                    <h3>{{ getSimilarPropertyTitle(prop) }}</h3>
                    <p class="location">üìç {{ getSimilarPropertyLocation(prop) }}</p>
                    <div class="specs">
                        <span *ngIf="prop.rooms">üõè {{ prop.rooms }}</span>
                        <span *ngIf="prop.bathrooms">üõÅ {{ prop.bathrooms }}</span>
                        <span *ngIf="prop.area">üìê {{ prop.area }} {{ 'PROPERTY_VIEW.SQ_M' | translate }}</span>
                    </div>
                    <div class="price-row">
                        <span class="price">{{ prop.price | currency:(prop.currency || 'EGP'):'symbol':'1.0-0' }}</span>
                        <span class="type">{{ getSimilarPropertyType(prop) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- Loading State -->
<div class="loading-state" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>{{ 'PROPERTY_VIEW.LOADING' | translate }}</p>
</div>

<!-- Error State -->
<div class="error-state" *ngIf="errorMessage && !isLoading">
    <p>{{ errorMessage }}</p>
</div>